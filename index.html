<script>
let noClickCount = 0;
let firstClick = null;

const webAppUrl = "https://script.google.com/macros/s/AKfycbyK9mU2nfwF_b3I1pWIejMV2G_L4oxpQ-_M-bk7jB3R6AbeW8gUJjJ6C0kjg5vHnQJa7A/exec";

const noContainer = document.getElementById("noContainer");
const bubble = document.getElementById("bubble");
const yesBtn = document.getElementById("yesBtn");
const message = document.getElementById("message");
const card = document.querySelector(".card");

const messages = [
    "You're my everything ðŸ˜‰",
    "You set my soul on fire ðŸ™ˆ",
    "I love every moment with you ðŸ’–",
    "Being with you feels like home ðŸ˜‰",
    "Heart says YES ðŸ’•"
];

let msgIndex = 0;

/* Common function to send data */
function sendData(answer) {
    fetch(webAppUrl, {
        method: "POST",
        mode: "no-cors",
        body: JSON.stringify({
            answer: answer,
            noCount: noClickCount,
            firstClick: firstClick,
            time: new Date().toLocaleString(),
            device: navigator.userAgent
        })
    });
}

/* NO button click */
noContainer.addEventListener("click", () => {

    noClickCount++;

    if (!firstClick) {
        firstClick = "NO ðŸ˜¢";
    }

    bubble.textContent = messages[msgIndex];
    bubble.style.display = "block";
    msgIndex = (msgIndex + 1) % messages.length;

    const cardRect = card.getBoundingClientRect();
    const btnRect = noContainer.getBoundingClientRect();

    const EDGE = 15;
    let x = Math.random() * (cardRect.width - btnRect.width - EDGE);
    let y = Math.random() * (cardRect.height - btnRect.height - EDGE);

    noContainer.style.left = x + "px";
    noContainer.style.top = y + "px";

    sendData("NO ðŸ˜¢");
});

/* Floating Hearts */
setInterval(() => {
    const h = document.createElement("div");
    h.className = "heart";
    h.innerHTML = "â¤ï¸";
    h.style.left = Math.random() * 100 + "vw";
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 5000);
}, 450);

/* Confetti */
function confettiBlast() {
    for (let i = 0; i < 120; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 4000);
    }
}

/* YES click */
yesBtn.addEventListener("click", () => {

    if (!firstClick) {
        firstClick = "YES ðŸ’–";
    }

    sendData("YES ðŸ’–");

    message.style.display = "block";
    message.style.animation = "waveIn 1.2s ease-out forwards";
    confettiBlast();
});
</script>
